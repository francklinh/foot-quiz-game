# üìã Cahier des Charges - CLAFOOTIX

**Application Mobile de Jeux de Football**

**Version** : 1.0  
**Date** : Octobre 2025  
**Statut** : Sp√©cifications Techniques Compl√®tes

---

## üìë Table des Mati√®res

1. [Vue d'Ensemble](#1-vue-densemble)
2. [Architecture Technique](#2-architecture-technique)
3. [Base de Donn√©es](#3-base-de-donn√©es)
4. [Fonctionnalit√©s Utilisateur](#4-fonctionnalit√©s-utilisateur)
5. [Fonctionnalit√©s Admin](#5-fonctionnalit√©s-admin)
6. [Syst√®me de Jeu](#6-syst√®me-de-jeu)
7. [Syst√®me de Ligues](#7-syst√®me-de-ligues)
8. [Syst√®me Social](#8-syst√®me-social)
9. [Syst√®me de Notifications](#9-syst√®me-de-notifications)
10. [√âconomie - Clafoutis](#10-√©conomie---clafoutis)
11. [S√©curit√© et Permissions](#11-s√©curit√©-et-permissions)
12. [Performance et Optimisation](#12-performance-et-optimisation)
13. [Roadmap de D√©veloppement](#13-roadmap-de-d√©veloppement)

---

## 1. Vue d'Ensemble

### 1.1 Concept

CLAFOOTIX est une application mobile de jeux de football permettant aux utilisateurs de tester leurs connaissances footballistiques √† travers 3 types de jeux :

- **TOP 10** : Deviner le top 10 d'un classement (ex: meilleurs buteurs)
- **GRILLE 3√ó3** : Remplir une grille en trouvant des joueurs selon des crit√®res crois√©s (ligue + pays)
- **CLUB** : Deviner le club actuel d‚Äôun joueur pr√©sent√© (photo/nom/indice), un joueur √† la fois

### 1.2 Modes de Jeu

| Mode | Description | Joueurs | Caract√©ristiques |
|------|-------------|---------|------------------|
| **Solo** | Partie individuelle | 1 | Imm√©diat, score personnel |
| **Multijoueur** | Partie asynchrone entre amis | 2-15 | Admin cr√©e, deadline configurable |
| **Ligue** | Tournoi permanent avec parties r√©guli√®res | Illimit√© | Admin cr√©e, parties g√©n√©r√©es automatiquement |

### 1.3 Objectifs

- Cr√©er une exp√©rience ludique autour du football
- Favoriser la comp√©tition amicale entre utilisateurs
- R√©compenser la connaissance footballistique via des cerises (monnaie virtuelle)
- Construire une communaut√© de passionn√©s de football

### 1.4 Public Cible

- Fans de football de tous √¢ges
- Utilisateurs cherchant des jeux de culture football
- Communaut√©s d'amis souhaitant se challenger

### 1.5 Plateformes

- iOS (iPhone, iPad)
- Android (smartphones, tablettes)
- Web (navigateurs modernes)

---

## 2. Architecture Technique

### 2.1 Stack Technologique

#### Frontend
```yaml
Framework: React (web) + React Native (mobile)
Langage: TypeScript
State Management: React Context API (choix par d√©faut)
Navigation: 
  - Web: React Router DOM
  - Mobile: React Navigation v6
Styling: 
  - Web: Tailwind CSS
  - Mobile: NativeWind (Tailwind CSS pour React Native)
Formulaires: React Hook Form
Validation: Zod
```

#### Backend
```yaml
BaaS: Supabase
Database: PostgreSQL (via Supabase)
Authentication: Supabase Auth
Storage: Supabase Storage (avatars, photos joueurs)
Realtime: Supabase Realtime (notifications, updates)
Functions: Supabase Edge Functions (logique m√©tier complexe)
```

#### Edge Functions (Supabase ‚Äì recommand√©)
```yaml
Objectif: D√©porter la logique sensible/complexe c√¥t√© serveur, proche de la base
Avantages: D√©ploiement simple, co√ªts faibles, s√©curit√© et scalabilit√© natives

Fonctions √† impl√©menter:
  - calculate-league-ranks: recalcul des rangs apr√®s chaque partie de ligue
  - generate-league-matches: cr√©ation automatique des parties selon la fr√©quence
  - send-notifications: envoi des notifications (in-app / push trigger)
  - validate-game-answers: point d‚Äôentr√©e unique pour valider une partie (orchestration des fonctions SQL validate_* et √©criture des scores)

Bonnes pratiques:
  - Auth: v√©rifier le r√¥le/uid Supabase JWT en entr√©e
  - RLS: utiliser service key uniquement c√¥t√© Edge Function si besoin
  - Observabilit√©: logs structur√©s + idempotence sur op√©rations sensibles
```

#### Notifications
```yaml
Push Notifications: 
  - iOS: Apple Push Notification Service (APNs)
  - Android: Firebase Cloud Messaging (FCM)
In-App Notifications: Supabase Realtime
```

#### Gestion des Donn√©es
```yaml
Donn√©es Football: Gestion manuelle via interface admin
Usage: Cr√©ation et mise √† jour des joueurs, clubs, statistiques via l'application
Interface Admin: Gestion compl√®te des donn√©es footballistiques
```

### 2.2 Structure des Dossiers

```
clafootix/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/              # Boutons, inputs, cards...
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game/                # Composants sp√©cifiques jeux
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Top10Game.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GrilleGame.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ClubGame.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ league/              # Gestion ligues
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ social/              # Amis, invitations
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout/              # Header, Footer, Navigation
‚îÇ   ‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginScreen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RegisterScreen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ForgotPasswordScreen.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ home/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ HomeScreen.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameSelectionScreen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GamePlayScreen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GameResultsScreen.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ league/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LeagueListScreen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LeagueDetailScreen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreateLeagueScreen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LeagueStandingsScreen.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfileScreen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ EditProfileScreen.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ leaderboard/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GlobalLeaderboardScreen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FriendsLeaderboardScreen.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ social/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FriendsScreen.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ InvitationsScreen.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AdminDashboard.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ManageQuestionsScreen.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ManagePlayersScreen.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ AdminStatsScreen.tsx
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useGame.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useLeague.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useNotifications.ts
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts          # Client Supabase
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts      # Authentification
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game.service.ts      # Logique jeu
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ league.service.ts    # Gestion ligues
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ social.service.ts    # Amis, invitations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notification.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ player.service.ts    # Autocompl√©tion
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation.ts        # Fonctions validation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scoring.ts           # Calcul scores
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ date.ts              # Manipulation dates
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.types.ts    # Types Supabase g√©n√©r√©s
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game.types.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.types.ts
‚îÇ   ‚îú‚îÄ‚îÄ constants/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ colors.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game.constants.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.ts
‚îÇ   ‚îî‚îÄ‚îÄ store/
‚îÇ       ‚îú‚îÄ‚îÄ authStore.ts
‚îÇ       ‚îú‚îÄ‚îÄ gameStore.ts
‚îÇ       ‚îî‚îÄ‚îÄ notificationStore.ts
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ fonts/
‚îÇ   ‚îî‚îÄ‚îÄ icons/
‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 001_initial_schema.sql
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 002_create_functions.sql
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 003_seed_data.sql
‚îÇ   ‚îú‚îÄ‚îÄ functions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-league-match/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ send-notifications/
‚îÇ   ‚îî‚îÄ‚îÄ seed.sql
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ README.md
```

**Note :** Structure partag√©e entre web et mobile. Les composants utilisent des props conditionnelles pour s'adapter aux plateformes.

---

## 3. Base de Donn√©es

### 3.1 Sch√©ma Global

La base de donn√©es PostgreSQL est organis√©e en **6 zones fonctionnelles** :

1. **üü¶ Utilisateurs** : Gestion des comptes et profils
2. **üü© Jeux & Parties** : Matchs et participations
3. **üü® Ligues** : Tournois et classements
4. **üü• Contenu** : Joueurs et questions
5. **üü™ Social** : Amiti√©s et notifications
6. **üüß Admin** : Administration et audit

**Total : 16 tables**

### 3.2 Diagramme ERD Simplifi√©

```
USERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îú‚îÄ‚îÄ‚Üí MATCH_PARTICIPANTS ‚îÄ‚îÄ‚Üí MATCHES ‚îÄ‚îÄ‚Üí GAME_TYPES
          ‚îú‚îÄ‚îÄ‚Üí LEAGUE_MEMBERS ‚îÄ‚îÄ‚Üí LEAGUES        ‚îÄ‚îÄ‚Üí QUESTIONS ‚îÄ‚îÄ‚Üí PLAYERS
          ‚îú‚îÄ‚îÄ‚Üí FRIENDSHIPS                        ‚îî‚îÄ‚îÄ‚Üí GRID_ANSWERS
          ‚îú‚îÄ‚îÄ‚Üí INVITATIONS
          ‚îú‚îÄ‚îÄ‚Üí NOTIFICATIONS
          ‚îî‚îÄ‚îÄ‚Üí ADMINS ‚îÄ‚îÄ‚Üí ADMIN_AUDIT_LOG
```

### 3.3 Tables D√©taill√©es

#### 3.3.1 **users** (Utilisateurs)

Table centrale des joueurs de l'application.

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  pseudo VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(255) UNIQUE NOT NULL,
  country VARCHAR(3),                    -- Code ISO (FRA, ESP, BRA...)
  avatar_url TEXT,
  cerises_balance INTEGER DEFAULT 0 CHECK (cerises_balance >= 0),
  global_score INTEGER DEFAULT 0 CHECK (global_score >= 0),
  global_rank INTEGER,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_users_global_rank ON users(global_rank) WHERE global_rank IS NOT NULL;
CREATE INDEX idx_users_pseudo ON users(pseudo);
```

**R√®gles m√©tier** :
- Pseudo unique, 3-50 caract√®res
- Email valid√© lors inscription
- `cerises_balance` : Monnaie virtuelle, jamais n√©gatif
- `global_score` : Somme de tous les scores (tous modes)
- `global_rank` : Position mondiale, calcul√© via fonction

---

#### 3.3.2 **game_types** (Types de Jeux)

R√©f√©rentiel des 3 types de jeux disponibles (donn√©es fixes).

```sql
CREATE TABLE game_types (
  id SERIAL PRIMARY KEY,
  code VARCHAR(20) UNIQUE NOT NULL,      -- 'TOP10', 'GRILLE', 'CLUB'
  name VARCHAR(100) NOT NULL,
  description TEXT,
  duration_seconds INTEGER DEFAULT 60,   -- Dur√©e de jeu
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Donn√©es initiales
INSERT INTO game_types (code, name, description, duration_seconds) VALUES
  ('TOP10', 'Top 10', 'Trouve les 10 √©l√©ments d''un classement', 60),
  ('GRILLE', 'Grille 3x3', 'Remplis la grille en trouvant un joueur par case', 60),
  ('CLUB', 'Club', 'Devine le club actuel des joueurs', 60);
```

---

#### 3.3.3 **players** (Joueurs de Football)

Base de donn√©es des joueurs pour autocompl√©tion et r√©f√©rence.

```sql
CREATE TABLE players (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name VARCHAR(200) NOT NULL,
  current_club VARCHAR(200),
  position VARCHAR(50),                  -- Attaquant, Milieu, D√©fenseur, Gardien
  nationality VARCHAR(100),
  nationality_code VARCHAR(3),           -- FRA, BRA, ARG...
  club_history JSONB,                    -- Historique clubs
  is_active BOOLEAN DEFAULT true,        -- Actif ou retrait√©
  is_verified BOOLEAN DEFAULT false,     -- V√©rifi√© par admin
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_players_name ON players(name);
CREATE INDEX idx_players_active ON players(is_active) WHERE is_active = true;
CREATE INDEX idx_players_nationality ON players(nationality_code);
```

**Exemple de `club_history` (JSONB)** :
```json
[
  {
    "club": "AS Monaco",
    "league": "Ligue 1",
    "country": "France",
    "start_year": 2015,
    "end_year": 2017
  },
  {
    "club": "PSG",
    "league": "Ligue 1",
    "country": "France",
    "start_year": 2017,
    "end_year": 2024
  },
  {
    "club": "Real Madrid",
    "league": "La Liga",
    "country": "Espagne",
    "start_year": 2024,
    "end_year": null
  }
]
```

**R√®gles m√©tier** :
- Autocompl√©tion simple : recherche sur `name` √† partir de 3 lettres
- `club_history` : Historique des clubs en JSONB pour flexibilit√©
- `is_verified` : Contr√¥le qualit√© par les admins

---

#### 3.3.4 **questions** (Banque de Questions)

Stockage des questions pour les 3 types de jeux.

```sql
CREATE TABLE questions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  game_type VARCHAR(20) NOT NULL CHECK (game_type IN ('TOP10', 'GRILLE', 'CLUB')),
  title VARCHAR(255) NOT NULL,           -- Titre simple de la question
  player_ids UUID[],                     -- R√©f√©rences vers players
  season VARCHAR(20),                    -- '2024-2025'
  is_active BOOLEAN DEFAULT true,        -- Visible aux joueurs
  is_archived BOOLEAN DEFAULT false,     -- Archiv√© (plus utilis√©)
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  archived_at TIMESTAMP WITH TIME ZONE
);

-- Indexes
CREATE INDEX idx_questions_game_type ON questions(game_type);
CREATE INDEX idx_questions_active ON questions(is_active) WHERE is_active = true;
CREATE INDEX idx_questions_season ON questions(season);
CREATE INDEX idx_questions_archived ON questions(is_archived) WHERE is_archived = true;
```

**Exemples de `title` selon `game_type`** :

**TOP10** (game_type = 'TOP10') :
- "Top 10 des meilleurs buteurs de Ligue 1 2024-2025"
- "Top 10 des meilleurs passeurs de Premier League 2023-2024"

**GRILLE** (game_type = 'GRILLE') :
- "Grille 3x3 : Ligue 1, Premier League, La Liga / France, Br√©sil, Argentine"
- "Grille 3x3 : Bundesliga, Serie A, Ligue 1 / Allemagne, Italie, France"

**CLUB** (game_type = 'CLUB') :
- "Devine le club actuel des joueurs (photo)"
- "Devine le club actuel des joueurs (nom + nationalit√©)"

Le champ `player_ids` contient les UUID des joueurs dans l'ordre pour TOP10, ou la liste compl√®te pour GRILLE/CLUB.

---

#### 3.3.5 **grid_answers** (R√©ponses Valides GRILLE)

Table s√©par√©e pour stocker les r√©ponses valides des grilles 3√ó3.

```sql
CREATE TABLE grid_answers (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  question_id UUID NOT NULL REFERENCES questions(id),
  league VARCHAR(100) NOT NULL,
  country VARCHAR(100) NOT NULL,
  player_id UUID NOT NULL REFERENCES players(id),
  is_active BOOLEAN DEFAULT true,
  is_archived BOOLEAN DEFAULT false,     -- Archiv√© avec la question
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  archived_at TIMESTAMP WITH TIME ZONE,
  UNIQUE(question_id, league, country, player_id)
);

-- Indexes
CREATE INDEX idx_grid_answers_question ON grid_answers(question_id);
CREATE INDEX idx_grid_answers_lookup ON grid_answers(question_id, league, country) 
  WHERE is_active = true;
CREATE INDEX idx_grid_answers_archived ON grid_answers(is_archived) WHERE is_archived = true;
```

**Exemple de donn√©es** :
| question_id | league | country | player_id |
|-------------|--------|---------|-----------|
| uuid-question-1 | Ligue 1 | France | uuid-mbappe |
| uuid-question-1 | Premier League | France | uuid-kante |
| uuid-question-1 | La Liga | Br√©sil | uuid-vinicius |

**R√®gles m√©tier** :
- Une combinaison (question_id, league, country, player_id) est unique
- Validation se fait via `player_id` + recherche simple sur `name` du joueur
- Archivage : Quand une question est archiv√©e, ses r√©ponses le sont aussi

---

#### 3.3.6 **matches** (Parties)

Table des parties jouables (solo, multi, ligue).

```sql
CREATE TABLE matches (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  game_type_id INTEGER NOT NULL REFERENCES game_types(id),
  mode VARCHAR(20) NOT NULL CHECK (mode IN ('solo', 'multiplayer', 'league')),
  league_id UUID REFERENCES leagues(id) ON DELETE CASCADE,
  match_number INTEGER,                  -- Num√©ro partie dans ligue
  admin_id UUID REFERENCES users(id),    -- Cr√©ateur (multi/ligue)
  max_players INTEGER DEFAULT 1 CHECK (max_players BETWEEN 1 AND 15),
  status VARCHAR(20) DEFAULT 'waiting' CHECK (status IN ('waiting', 'in_progress', 'completed', 'expired')),
  start_date TIMESTAMP WITH TIME ZONE NOT NULL,
  end_date TIMESTAMP WITH TIME ZONE NOT NULL,  -- Deadline
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  completed_at TIMESTAMP WITH TIME ZONE,
  
  CHECK (
    (mode = 'solo' AND max_players = 1) OR
    (mode = 'multiplayer' AND max_players BETWEEN 2 AND 15) OR
    (mode = 'league' AND league_id IS NOT NULL)
  )
);

-- Indexes
CREATE INDEX idx_matches_mode ON matches(mode);
CREATE INDEX idx_matches_league ON matches(league_id) WHERE league_id IS NOT NULL;
CREATE INDEX idx_matches_status ON matches(status);
CREATE INDEX idx_matches_end_date ON matches(end_date) 
  WHERE status IN ('waiting', 'in_progress');
```

**R√®gles m√©tier** :
- Mode solo : 1 seul joueur, pas d'admin
- Mode multiplayer : 2-15 joueurs, avec admin, deadline configurable
- Mode league : li√© √† une ligue, deadline configurable, tous les membres participent

---

#### 3.3.7 **match_participants** (Participants aux Parties)

Lien entre joueurs et parties, stockage des scores.

```sql
CREATE TABLE match_participants (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  match_id UUID NOT NULL REFERENCES matches(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  score INTEGER DEFAULT 0 CHECK (score >= 0),
  rank INTEGER,                          -- Position finale (1er, 2e...)
  completed_at TIMESTAMP WITH TIME ZONE,
  cerises_earned INTEGER DEFAULT 0 CHECK (cerises_earned >= 0),
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'playing', 'completed', 'expired')),
  user_responses JSONB,                  -- Optionnel (analytics)
  UNIQUE(match_id, user_id)
);

-- Indexes
CREATE INDEX idx_match_participants_user ON match_participants(user_id);
CREATE INDEX idx_match_participants_match ON match_participants(match_id);
CREATE INDEX idx_match_participants_status ON match_participants(status);
```

**R√®gles m√©tier** :
- Un user ne peut participer qu'une fois par match
- Score calcul√© c√¥t√© app via fonctions de validation
- `rank` calcul√© apr√®s que tous ont termin√© ou deadline atteinte
- `user_responses` optionnel pour MVP (utile pour analytics phase 2)

---

#### 3.3.8 **match_questions** (Questions des Parties)

Lien entre parties et questions (1 match = 1 question).

```sql
CREATE TABLE match_questions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  match_id UUID NOT NULL REFERENCES matches(id) ON DELETE CASCADE,
  question_id UUID NOT NULL REFERENCES questions(id),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(match_id, question_id)
);

-- Indexes
CREATE INDEX idx_match_questions_match ON match_questions(match_id);
CREATE INDEX idx_match_questions_question ON match_questions(question_id);
```

**R√®gles m√©tier** :
- **1 match = 1 question unique**
- Tous les participants d'un match jouent la m√™me question
- En ligue : tous les membres de la ligue ont la m√™me question pour une partie donn√©e

---

#### 3.3.9 **leagues** (Ligues/Tournois)

Tournois permanents avec parties r√©guli√®res.

```sql
CREATE TABLE leagues (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name VARCHAR(100) NOT NULL,
  admin_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  total_matches INTEGER NOT NULL CHECK (total_matches > 0),
  match_frequency VARCHAR(20) NOT NULL CHECK (match_frequency IN ('daily', 'weekly', 'monthly')),
  current_match_number INTEGER DEFAULT 0 CHECK (current_match_number >= 0),
  start_date TIMESTAMP WITH TIME ZONE NOT NULL,
  next_match_date TIMESTAMP WITH TIME ZONE,
  status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'completed', 'cancelled')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_leagues_admin ON leagues(admin_id);
CREATE INDEX idx_leagues_status ON leagues(status);
CREATE INDEX idx_leagues_next_match ON leagues(next_match_date) 
  WHERE status = 'active';
```

**R√®gles m√©tier** :
- Admin cr√©e la ligue avec :
  - Nombre total de parties (ex: 10)
  - Fr√©quence (daily/weekly/monthly)
  - Participants (via invitations)
- Parties g√©n√©r√©es automatiquement selon `match_frequency`
- Type de jeu al√©atoire pour chaque partie
- Tous les membres jouent la m√™me question

**Exemple** :
- Ligue "Entre Amis" : 8 parties, 1 par semaine, 6 participants
- Chaque lundi √† 12h00 : nouvelle partie cr√©√©e automatiquement
- Deadline : mardi 12h00 (24h)
- Type de jeu : al√©atoire (TOP10, GRILLE ou CLUB)

---

#### 3.3.10 **league_members** (Membres des Ligues)

Participants aux ligues et leurs scores cumul√©s.

```sql
CREATE TABLE league_members (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  league_id UUID NOT NULL REFERENCES leagues(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  total_score INTEGER DEFAULT 0 CHECK (total_score >= 0),
  rank INTEGER,                          -- Position dans la ligue
  joined_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'left', 'kicked')),
  UNIQUE(league_id, user_id)
);

-- Indexes
CREATE INDEX idx_league_members_user ON league_members(user_id);
CREATE INDEX idx_league_members_league ON league_members(league_id);
CREATE INDEX idx_league_members_rank ON league_members(league_id, rank) 
  WHERE rank IS NOT NULL;
```

**R√®gles m√©tier** :
- `total_score` = somme des scores de toutes les parties de la ligue
- `rank` recalcul√© apr√®s chaque partie via fonction `calculate_league_ranks()`
- Un user peut √™tre membre de plusieurs ligues simultan√©ment

---

#### 3.3.11 **friendships** (Amiti√©s)

Relations d'amiti√© entre utilisateurs.

```sql
CREATE TABLE friendships (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  friend_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'accepted', 'rejected', 'blocked')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  responded_at TIMESTAMP WITH TIME ZONE,
  CHECK (user_id != friend_id),
  UNIQUE(user_id, token)
);

-- Indexes
CREATE INDEX idx_push_tokens_user ON push_tokens(user_id);
CREATE INDEX idx_push_tokens_active ON push_tokens(is_active) WHERE is_active = true;
```

**R√®gles m√©tier** :
- Un user peut avoir plusieurs tokens (plusieurs appareils)
- Token d√©sactiv√© lors d√©connexion ou d√©sinstallation app

---

#### 3.3.15 **admins** (Administrateurs)

Utilisateurs avec privil√®ges administrateur.

```sql
CREATE TABLE admins (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE UNIQUE,
  role VARCHAR(20) DEFAULT 'admin' CHECK (role IN ('super_admin', 'admin', 'moderator')),
  permissions JSONB DEFAULT '{"can_create": true, "can_edit": true, "can_delete": true, "can_publish": true}'::JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_by UUID REFERENCES admins(id),
  is_active BOOLEAN DEFAULT true
);

-- Indexes
CREATE INDEX idx_admins_user ON admins(user_id) WHERE is_active = true;
CREATE INDEX idx_admins_role ON admins(role);
```

**Structure `permissions` (JSONB)** :
```json
{
  "can_create": true,
  "can_edit": true,
  "can_delete": false,
  "can_publish": true,
  "can_manage_users": false,
  "can_manage_admins": false,
  "can_view_analytics": true
}
```

---

#### 3.3.16 **admin_audit_log** (Journal d'Audit)

Historique de toutes les actions administrateur.

```sql
CREATE TABLE admin_audit_log (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  admin_id UUID NOT NULL REFERENCES admins(id),
  action VARCHAR(50) NOT NULL,           -- 'create', 'update', 'delete', 'publish'
  entity_type VARCHAR(50) NOT NULL,      -- 'question', 'player', 'grid_answer'
  entity_id UUID NOT NULL,
  old_data JSONB,                        -- √âtat avant
  new_data JSONB,                        -- √âtat apr√®s
  ip_address INET,
  user_agent TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_audit_admin ON admin_audit_log(admin_id);
CREATE INDEX idx_audit_entity ON admin_audit_log(entity_type, entity_id);
CREATE INDEX idx_audit_created ON admin_audit_log(created_at DESC);
CREATE INDEX idx_audit_action ON admin_audit_log(action);
```

**R√®gles m√©tier** :
- Chaque action admin est trac√©e
- Impossible de supprimer les logs (int√©grit√©)
- Utilis√© pour debug et s√©curit√©

---

### 3.4 Fonctions PostgreSQL

#### 3.4.1 Calcul Classement Ligue

```sql
CREATE OR REPLACE FUNCTION calculate_league_ranks(p_league_id UUID)
RETURNS void AS $
BEGIN
  WITH ranked_members AS (
    SELECT 
      id,
      RANK() OVER (ORDER BY total_score DESC) as new_rank
    FROM league_members
    WHERE league_id = p_league_id AND status = 'active'
  )
  UPDATE league_members lm
  SET rank = rm.new_rank
  FROM ranked_members rm
  WHERE lm.id = rm.id;
END;
$ LANGUAGE plpgsql;
```

**Usage** : Appel√©e apr√®s chaque partie de ligue termin√©e.

---

#### 3.4.2 Calcul Classement Global

```sql
CREATE OR REPLACE FUNCTION calculate_global_ranks()
RETURNS void AS $
BEGIN
  WITH ranked_users AS (
    SELECT 
      id,
      RANK() OVER (ORDER BY global_score DESC) as new_rank
    FROM users
    WHERE global_score > 0
  )
  UPDATE users u
  SET global_rank = ru.new_rank
  FROM ranked_users ru
  WHERE u.id = ru.id;
  
  UPDATE users SET global_rank = NULL WHERE global_score = 0;
END;
$ LANGUAGE plpgsql;
```

**Usage** : Appel√©e p√©riodiquement (cron) ou apr√®s chaque partie.

---

#### 3.4.3 Recherche Joueurs (Autocompl√©tion)

```sql
CREATE OR REPLACE FUNCTION search_players(
  p_search_term TEXT,
  p_limit INTEGER DEFAULT 10,
  p_filters JSONB DEFAULT NULL
)
RETURNS TABLE(
  id UUID,
  name VARCHAR,
  current_club VARCHAR,
  nationality VARCHAR,
  photo_url TEXT,
  position VARCHAR,
  relevance REAL
) AS $
DECLARE
  v_nationality TEXT;
  v_position TEXT;
BEGIN
  v_nationality := p_filters->>'nationality';
  v_position := p_filters->>'position';
  
  RETURN QUERY
  SELECT 
    p.id,
    p.name,
    p.current_club,
    p.nationality,
    p.photo_url,
    p.position,
    ts_rank(p.search_vector, plainto_tsquery('french', p_search_term)) +
    (p.popularity_score::REAL / 1000) as relevance
  FROM players p
  WHERE 
    p.is_active = true
    AND (
      p.search_vector @@ plainto_tsquery('french', p_search_term)
      OR p.name ILIKE '%' || p_search_term || '%'
      OR EXISTS(
        SELECT 1 FROM unnest(p.name_variations) as v
        WHERE v ILIKE '%' || p_search_term || '%'
      )
    )
    AND (v_nationality IS NULL OR p.nationality_code = v_nationality)
    AND (v_position IS NULL OR p.position = v_position)
  ORDER BY relevance DESC, p.popularity_score DESC
  LIMIT p_limit;
END;
$ LANGUAGE plpgsql;
```

**Usage** : Appel√©e lors de la saisie utilisateur pour autocompl√©tion.

---

#### 3.4.4 Validation R√©ponse TOP10

```sql
CREATE OR REPLACE FUNCTION validate_top10_answer(
  p_question_id UUID,
  p_user_answers TEXT[]
)
RETURNS TABLE(
  correct_count INTEGER,
  correct_answers TEXT[],
  score INTEGER
) AS $
DECLARE
  v_player_ids UUID[];
  v_correct TEXT[];
  v_user_answer TEXT;
  v_normalized TEXT;
  v_player RECORD;
BEGIN
  SELECT player_ids INTO v_player_ids
  FROM questions
  WHERE id = p_question_id;
  
  v_correct := ARRAY[]::TEXT[];
  
  FOREACH v_user_answer IN ARRAY p_user_answers
  LOOP
    v_normalized := LOWER(TRIM(v_user_answer));
    
    FOR v_player IN 
      SELECT p.id, p.name
      FROM players p
      WHERE p.id = ANY(v_player_ids)
        AND (
          LOWER(p.name) = v_normalized
          OR v_normalized = ANY(
            SELECT LOWER(unnest(p.name_variations))
          )
        )
    LOOP
      v_correct := array_append(v_correct, v_player.name);
      EXIT;
    END LOOP;
  END LOOP;
  
  RETURN QUERY SELECT
    array_length(v_correct, 1),
    v_correct,
    array_length(v_correct, 1) * 10;
END;
$ LANGUAGE plpgsql;
```

**Usage** : Appel√©e c√¥t√© app pour calculer le score du joueur.

---

#### 3.4.5 Validation R√©ponse GRILLE

```sql
CREATE OR REPLACE FUNCTION validate_grid_answer(
  p_question_id UUID,
  p_user_grid JSONB
)
RETURNS TABLE(
  correct_count INTEGER,
  correct_answers JSONB,
  incorrect_answers JSONB,
  score INTEGER
) AS $
DECLARE
  v_content JSONB;
  v_grid_id TEXT;
  v_cell_key TEXT;
  v_user_answer TEXT;
  v_league TEXT;
  v_country TEXT;
  v_is_valid BOOLEAN;
  v_correct JSONB := '{}'::JSONB;
  v_incorrect JSONB := '{}'::JSONB;
  v_correct_count INTEGER := 0;
BEGIN
  SELECT content->>'grid_id' INTO v_grid_id
  FROM questions
  WHERE id = p_question_id;
  
  FOR v_cell_key, v_user_answer IN SELECT * FROM jsonb_each_text(p_user_grid)
  LOOP
    v_league := split_part(v_cell_key, '_', 1);
    v_country := split_part(v_cell_key, '_', 2);
    
    SELECT EXISTS(
      SELECT 1 
      FROM grid_answers ga
      JOIN players p ON ga.player_id = p.id
      WHERE ga.grid_id = v_grid_id
        AND ga.league = v_league
        AND ga.country = v_country
        AND (
          LOWER(p.name) = LOWER(TRIM(v_user_answer))
          OR LOWER(TRIM(v_user_answer)) = ANY(
            SELECT LOWER(unnest(p.name_variations))
          )
        )
    ) INTO v_is_valid;
    
    IF v_is_valid THEN
      v_correct := v_correct || jsonb_build_object(v_cell_key, v_user_answer);
      v_correct_count := v_correct_count + 1;
    ELSE
      v_incorrect := v_incorrect || jsonb_build_object(v_cell_key, v_user_answer);
    END IF;
  END LOOP;
  
  RETURN QUERY SELECT
    v_correct_count,
    v_correct,
    v_incorrect,
    v_correct_count * 10;
END;
$ LANGUAGE plpgsql;
```

---

#### 3.4.6 Validation R√©ponse CLUB

```sql
CREATE OR REPLACE FUNCTION validate_club_answers(
  p_question_id UUID,
  p_user_answers JSONB
)
RETURNS TABLE(
  correct_count INTEGER,
  total_players INTEGER,
  correct_answers JSONB,
  score INTEGER
) AS $
DECLARE
  v_player_ids UUID[];
  v_player RECORD;
  v_user_club TEXT;
  v_is_correct BOOLEAN;
  v_correct JSONB := '{}'::JSONB;
  v_correct_count INTEGER := 0;
  v_total INTEGER;
BEGIN
  SELECT player_ids INTO v_player_ids
  FROM questions
  WHERE id = p_question_id;
  
  v_total := array_length(v_player_ids, 1);
  
  FOR v_player IN 
    SELECT p.id, p.name, p.current_club
    FROM players p
    WHERE p.id = ANY(v_player_ids)
  LOOP
    v_user_club := p_user_answers->>v_player.name;
    
    IF v_user_club IS NOT NULL THEN
      v_is_correct := LOWER(TRIM(v_user_club)) = LOWER(v_player.current_club);
      
      IF v_is_correct THEN
        v_correct := v_correct || jsonb_build_object(
          v_player.name, 
          jsonb_build_object(
            'user_answer', v_user_club,
            'correct_club', v_player.current_club
          )
        );
        v_correct_count := v_correct_count + 1;
      END IF;
    END IF;
  END LOOP;
  
  RETURN QUERY SELECT
    v_correct_count,
    v_total,
    v_correct,
    v_correct_count * 10;
END;
$ LANGUAGE plpgsql;
```

---

### 3.5 Triggers

#### 3.5.1 Auto-update `updated_at`

```sql
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$ LANGUAGE plpgsql;

CREATE TRIGGER update_users_updated_at 
  BEFORE UPDATE ON users
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_players_updated_at 
  BEFORE UPDATE ON players
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_leagues_updated_at 
  BEFORE UPDATE ON leagues
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

---

#### 3.5.2 Auto-generate Player Slug

```sql
CREATE OR REPLACE FUNCTION generate_player_slug()
RETURNS TRIGGER AS $
BEGIN
  IF NEW.slug IS NULL THEN
    NEW.slug := lower(regexp_replace(
      unaccent(NEW.name), 
      '[^a-z0-9]+', 
      '-', 
      'gi'
    ));
  END IF;
  RETURN NEW;
END;
$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_generate_player_slug
  BEFORE INSERT OR UPDATE ON players
  FOR EACH ROW EXECUTE FUNCTION generate_player_slug();
```

---

#### 3.5.3 Auto-update Search Vector

```sql
CREATE OR REPLACE FUNCTION players_search_vector_update()
RETURNS TRIGGER AS $
BEGIN
  NEW.search_vector := 
    setweight(to_tsvector('french', coalesce(NEW.name, '')), 'A') ||
    setweight(to_tsvector('french', coalesce(NEW.current_club, '')), 'B') ||
    setweight(to_tsvector('french', array_to_string(NEW.name_variations, ' ')), 'C');
  RETURN NEW;
END;
$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_players_search_vector
  BEFORE INSERT OR UPDATE ON players
  FOR EACH ROW EXECUTE FUNCTION players_search_vector_update();
```

---

## 4. Fonctionnalit√©s Admin

### 4.1 Interface de Gestion des Joueurs

**√âcran** : `AdminPlayersScreen`

**Fonctionnalit√©s** :
- **Liste des joueurs** avec filtres (nom, club, nationalit√©, statut)
- **Ajout de joueur** : Formulaire simple (nom, club, position, nationalit√©)
- **Modification** : √âdition des informations joueur
- **Archivage** : D√©sactiver un joueur (is_active = false)
- **V√©rification** : Marquer un joueur comme v√©rifi√© (is_verified = true)

**Formulaire Ajout/Modification** :
```
Nom du joueur *
[Kylian Mbapp√©________________]

Club actuel
[Real Madrid_________________]

Position
[Attaquant ‚ñº] (Attaquant, Milieu, D√©fenseur, Gardien)

Nationalit√©
[France ‚ñº] (Liste d√©roulante pays)

Historique des clubs (JSONB)
[{"club": "PSG", "start_year": 2017, "end_year": 2024}]

[Enregistrer] [Annuler]
```

### 4.2 Interface de Gestion des Questions

**√âcran** : `AdminQuestionsScreen`

**Fonctionnalit√©s** :
- **Liste des questions** par type (TOP10, GRILLE, CLUB)
- **Cr√©ation de question** : Formulaire adapt√© selon le type
- **Modification** : √âdition des questions existantes
- **Archivage** : Archiver une question (is_archived = true)
- **S√©lection des joueurs** : Interface pour choisir les joueurs de la question

**Formulaire Cr√©ation Question** :
```
Type de jeu *
[TOP10 ‚ñº] (TOP10, GRILLE, CLUB)

Titre de la question *
[Top 10 des meilleurs buteurs de Ligue 1 2024-2025]

Saison
[2024-2025]

S√©lection des joueurs
[Rechercher joueur...]
üë§ Kylian Mbapp√© (Real Madrid) [√ó]
üë§ Wissam Ben Yedder (AS Monaco) [√ó]
...

[Cr√©er la Question]
```

### 4.3 Interface de Gestion des R√©ponses GRILLE

**√âcran** : `AdminGridAnswersScreen`

**Fonctionnalit√©s** :
- **S√©lection de la question GRILLE** : Liste d√©roulante
- **Grille interactive** : Interface 3x3 pour d√©finir les r√©ponses valides
- **Ajout de r√©ponse** : Par case (ligue + pays + joueur)
- **Modification** : Changer les r√©ponses valides
- **Archivage** : Archiver avec la question

**Interface Grille** :
```
Question: Grille 3x3 : Ligue 1, Premier League, La Liga / France, Br√©sil, Argentine

          Ligue 1   Premier League   La Liga
France    [Kylian Mbapp√©] [N'Golo Kant√©] [_____]
Br√©sil    [_____]         [_____]       [Vin√≠cius J√∫nior]
Argentine [_____]         [_____]       [_____]

[Enregistrer les R√©ponses]
```

**Flux d'ajout de r√©ponse** :
1. Clic sur une case vide
2. Recherche de joueur (autocompl√©tion)
3. S√©lection du joueur
4. Validation et ajout √† la case

### 4.4 Interface de Gestion des Jeux

**√âcran** : `AdminGamesScreen`

**Fonctionnalit√©s** :
- **Liste des jeux** : TOP10, GRILLE, CLUB avec statut
- **Cr√©ation de jeu** : Formulaire pour nouveau jeu
- **Modification** : √âdition des jeux existants
- **Suppression** : Suppression avec confirmation
- **Activation/D√©sactivation** : Basculement statut actif

**Interface Liste** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üéÆ Gestion des Jeux                 ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  TOP 10                         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Statut: ‚úÖ Actif               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Prix: 50 cerises               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  [Modifier] [Supprimer]         ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  GRILLE 3x3                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Statut: ‚ùå Inactif              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Prix: 75 cerises                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  [Modifier] [Supprimer]         ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  [Cr√©er un nouveau jeu]             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Formulaire Cr√©ation/Modification** :
```
Nom du jeu *
[TOP 10________________]

Description
[Trouve les 10 meilleurs buteurs de Ligue 1]

Prix en cerises *
[50]

Statut
[‚úÖ Actif] [‚ùå Inactif]

[Enregistrer] [Annuler]
```

### 4.5 Interface de Gestion des Joueurs (D√©taill√©e)

**√âcran** : `AdminPlayersScreen`

**Fonctionnalit√©s avanc√©es** :
- **Recherche avanc√©e** : Filtres multiples (nom, club, nationalit√©, position)
- **Tri** : Par nom, club, nationalit√©, date de cr√©ation
- **Pagination** : Gestion des grandes listes
- **Import/Export** : CSV pour import en masse
- **Statistiques** : Nombre de joueurs par club/nationalit√©

**Interface Liste Avanc√©e** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üë• Gestion des Joueurs (247)       ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  [Rechercher...] [Filtrer] [Importer]‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Kylian Mbapp√©                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Real Madrid ‚Ä¢ Attaquant ‚Ä¢ üá´üá∑   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚úÖ V√©rifi√© ‚Ä¢ [Modifier] [Suppr]‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Wissam Ben Yedder               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  AS Monaco ‚Ä¢ Attaquant ‚Ä¢ üá´üá∑     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚ùå Non v√©rifi√© ‚Ä¢ [Modifier] [Suppr]‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  [Ajouter un joueur] [Export CSV]    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Filtres disponibles** :
- **Club** : Liste d√©roulante avec tous les clubs
- **Nationalit√©** : Liste d√©roulante avec tous les pays
- **Position** : Attaquant, Milieu, D√©fenseur, Gardien
- **Statut** : V√©rifi√©, Non v√©rifi√©, Actif, Inactif
- **Date** : Cr√©√©s r√©cemment, Anciens

### 4.6 Interface de Gestion des Questions (D√©taill√©e)

**√âcran** : `AdminQuestionsScreen`

**Fonctionnalit√©s avanc√©es** :
- **Recherche** : Par titre, type, saison
- **Filtres** : Type de jeu, saison, statut
- **Statistiques** : Nombre d'utilisations, popularit√©
- **Duplication** : Cr√©er une question similaire
- **Archivage en masse** : S√©lection multiple

**Interface Liste Avanc√©e** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚ùì Gestion des Questions (156)      ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  [Rechercher...] [Filtrer] [Archiver]‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  TOP 10 ‚Ä¢ 2024-2025              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Top 10 des meilleurs buteurs... ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚úÖ Actif ‚Ä¢ 23 utilisations      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  [Modifier] [Dupliquer] [Archiver]‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  GRILLE ‚Ä¢ 2024-2025             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Grille 3x3 : Ligue 1, PL...    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚ùå Inactif ‚Ä¢ 5 utilisations     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  [Modifier] [Dupliquer] [Archiver]‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  [Cr√©er une question] [Import CSV]   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 4.7 Interface de Gestion des R√©ponses GRILLE (D√©taill√©e)

**√âcran** : `AdminGridAnswersScreen`

**Fonctionnalit√©s avanc√©es** :
- **S√©lection question** : Liste d√©roulante avec filtres
- **Grille interactive** : Interface 3x3 avec drag & drop
- **R√©ponses multiples** : Plusieurs joueurs par case
- **Validation** : V√©rification des r√©ponses valides
- **Export** : Export des r√©ponses en CSV

**Interface Grille Avanc√©e** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üéØ Gestion des R√©ponses GRILLE     ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  Question: [Grille 3x3 : Ligue 1...]‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ          Ligue 1   Premier League   La Liga
‚îÇ  France    [Kylian Mbapp√©] [N'Golo Kant√©] [_____]
‚îÇ           [Wissam Ben Yedder] [_____]    [_____]
‚îÇ  Br√©sil    [_____]         [_____]       [Vin√≠cius J√∫nior]
‚îÇ  Argentine [_____]         [_____]       [_____]
‚îÇ                                      ‚îÇ
‚îÇ  [Ajouter r√©ponse] [Valider] [Export]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Flux d'ajout de r√©ponse avanc√©** :
1. **S√©lection case** : Clic sur case vide ou existante
2. **Recherche joueur** : Autocompl√©tion avec filtres (club, nationalit√©)
3. **S√©lection** : Choix du joueur
4. **Validation** : V√©rification que le joueur correspond aux crit√®res
5. **Ajout** : Ajout √† la case avec possibilit√© de plusieurs joueurs

---

## 5. Fonctionnalit√©s Utilisateur

### 4.1 Authentification

#### 4.1.1 Inscription

**√âcran** : `RegisterScreen`

**Champs** :
- Email (requis, unique, validation format)
- Pseudo (requis, unique, 3-50 caract√®res)
- Mot de passe (requis, min 8 caract√®res)
- Pays (optionnel, liste d√©roulante)

**Flux** :
1. Utilisateur remplit formulaire
2. Validation c√¥t√© client (React Hook Form + Zod)
3. Appel `supabase.auth.signUp()`
4. Envoi email de confirmation
5. Cr√©ation automatique entr√©e dans `users` table
6. Redirection vers √©cran de confirmation

**Validation Zod** :
```typescript
const registerSchema = z.object({
  email: z.string().email('Email invalide'),
  pseudo: z.string().min(3).max(50).regex(/^[a-zA-Z0-9_-]+$/),
  password: z.string().min(8, 'Minimum 8 caract√®res'),
  country: z.string().length(3).optional()
});
```

---

#### 4.1.2 Connexion

**√âcran** : `LoginScreen`

**Champs** :
- Email
- Mot de passe

**Flux** :
1. Saisie email/mot de passe
2. Appel `supabase.auth.signInWithPassword()`
3. R√©cup√©ration session
4. Chargement donn√©es user depuis `users` table
5. Stockage session dans state global (Zustand)
6. Redirection vers `HomeScreen`

**S√©curit√©** :
- Maximum 5 tentatives rat√©es ‚Üí blocage temporaire 15 min
- Session valide 7 jours (refresh token)

---

#### 4.1.3 R√©initialisation Mot de Passe

**√âcran** : `ForgotPasswordScreen`

**Flux** :
1. Utilisateur saisit email
2. Appel `supabase.auth.resetPasswordForEmail()`
3. Email envoy√© avec lien de reset
4. Clic sur lien ‚Üí redirection vers app
5. Formulaire nouveau mot de passe
6. Mise √† jour via `supabase.auth.updateUser()`

---

### 4.2 Profil Utilisateur

#### 4.2.1 Affichage Profil

**√âcran** : `ProfileScreen`

**Sections** :

**A. En-t√™te**
- Photo de profil (avatar)
- Pseudo
- Pays (drapeau)
- Bouton √©diter (ic√¥ne crayon)

**B. Statistiques**
```
üçí Cerises : 237
üèÜ Score Global : 8,450
üìä Rang Mondial : #187
```

**C. Statistiques D√©taill√©es**
- Parties jou√©es (total)
  - Solo : 45
  - Multijoueur : 12
  - Ligues : 23
- Victoires : 15
- Taux de victoire : 34%
- Meilleur score :
  - TOP10 : 90/100
  - GRILLE : 80/90
  - CLUB : 120/150

**API Call** :
```typescript
// R√©cup√©rer user
const { data: user } = await supabase
  .from('users')
  .select('*')
  .eq('id', userId)
  .single();

// R√©cup√©rer stats
const { data: stats } = await supabase
  .from('match_participants')
  .select('score, completed_at, matches(mode, game_type_id)')
  .eq('user_id', userId)
  .eq('status', 'completed');
```

---

#### 4.2.2 √âdition Profil

**√âcran** : `EditProfileScreen`

**Champs √©ditables** :
- Photo de profil (upload ou s√©lection avatars pr√©d√©finis)
- Pseudo
- Pays

**Flux** :
1. Clic bouton √©diter sur `ProfileScreen`
2. Navigation vers `EditProfileScreen`
3. Modification des champs
4. Validation :
   - Pseudo unique (v√©rification en temps r√©el)
   - Image max 2MB
5. Clic "Enregistrer"
6. Upload image vers Supabase Storage (si chang√©e)
7. Mise √† jour `users` table
8. Retour vers `ProfileScreen`

**Upload Avatar** :
```typescript
const uploadAvatar = async (file: File) => {
  const fileName = `${userId}_${Date.now()}.jpg`;
  
  const { data, error } = await supabase.storage
    .from('avatars')
    .upload(fileName, file);
  
  if (error) throw error;
  
  const { data: urlData } = supabase.storage
    .from('avatars')
    .getPublicUrl(fileName);
  
  await supabase
    .from('users')
    .update({ avatar_url: urlData.publicUrl })
    .eq('id', userId);
};
```

---

### 4.3 Menu Principal (Home)

**√âcran** : `HomeScreen`

**Layout** :

**A. Header (Ruban sup√©rieur)**
- Compteur cerises (gauche)
- Logo CLAFOOTIX (centre)
- Ic√¥ne profil (droite)

**B. Grille de Jeux (2√ó2)**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   TOP 10     ‚îÇ   GRILLE     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ    CLUB      ‚îÇ COMING SOON  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**C. Bouton Flottant (Ballon)**
- Position : Bas centre
- Au clic : Overlay avec 4 options
  - ‚öôÔ∏è R√©glages
  - üìä Stats
  - üõí Shop
  - üéÆ Acheter des jeux

**Navigation** :
- Clic TOP10 ‚Üí `GameSelectionScreen` (game_type='TOP10')
- Clic GRILLE ‚Üí `GameSelectionScreen` (game_type='GRILLE')
- Clic CLUB ‚Üí `GameSelectionScreen` (game_type='CLUB')
- Clic Profil ‚Üí `ProfileScreen`
- Clic "Acheter des jeux" ‚Üí `BuyGamesScreen`

---

### 4.4 S√©lection Mode de Jeu

**√âcran** : `GameSelectionScreen`

**Props** : `game_type` ('TOP10', 'GRILLE', 'CLUB')

**Layout** :

**A. R√®gles du Jeu** (encadr√© rouge)
```
REGLES DU JEU

[Description selon game_type]

‚è±Ô∏è 60 secondes
```

**B. S√©lection Mode**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   üë§     ‚îÇ  ‚îÇ  üë•üë•   ‚îÇ  ‚îÇ  üèÜ     ‚îÇ
‚îÇ   SOLO   ‚îÇ  ‚îÇMULTIJOUEUR‚îÇ  ‚îÇ  LIGUE  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Descriptions** :
- **TOP10** : "Trouve les 10 meilleurs buteurs de Ligue 1"
- **GRILLE** : "Remplis la grille 3√ó3 en trouvant un joueur par case"
- **CLUB** : "Devine le club actuel des joueurs pr√©sent√©s"

**Flux** :

**Mode SOLO** :
1. Clic "SOLO"
2. Cr√©ation partie imm√©diate
3. Navigation vers `GamePlayScreen`

**Mode MULTIJOUEUR** :
1. Clic "MULTIJOUEUR"
2. Navigation vers `CreateMultiplayerScreen`
3. S√©lection amis (2-15)
4. Envoi invitations
5. Attente acceptations
6. Partie lanc√©e quand tous ont accept√©

**Mode LIGUE** :
1. Clic "LIGUE"
2. Navigation vers `LeagueListScreen`
3. S√©lection ligue existante ou cr√©ation nouvelle
4. Participation aux parties de la ligue

---

### 4.5 √âcran de Jeu

**√âcran** : `GamePlayScreen`

**Props** : `match_id`

#### 4.5.1 Layout Commun (tous jeux)

**Header** :
- Timer (compte √† rebours 60s)
- Score actuel

**Footer** :
- Bouton "Abandonner" (confirmation requise)

---

#### 4.5.2 TOP10 - Interface

**Zone centrale** :
```
Question: Top 10 des meilleurs buteurs de Ligue 1 2024-2025

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. [Kylian Mbapp√©_____________] ‚úì  ‚îÇ
‚îÇ  2. [______________________]        ‚îÇ
‚îÇ  3. [______________________]        ‚îÇ
‚îÇ  4. [______________________]        ‚îÇ
‚îÇ  5. [______________________]        ‚îÇ
‚îÇ  6. [______________________]        ‚îÇ
‚îÇ  7. [______________________]        ‚îÇ
‚îÇ  8. [______________________]        ‚îÇ
‚îÇ  9. [______________________]        ‚îÇ
‚îÇ 10. [______________________]        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Score: 1/10
```

**Fonctionnalit√©s** :
- Autocompl√©tion sur chaque champ (appel `search_players()`)
- Validation imm√©diate (ic√¥ne ‚úì ou ‚úó)
- Pas de r√©-saisie m√™me joueur (disabled apr√®s validation)

**Fin de partie** :
- Timer √† 0 OU 10 joueurs trouv√©s
- Appel `validate_top10_answer()`
- Calcul score final
- Navigation vers `GameResultsScreen`

---

#### 4.5.3 GRILLE - Interface

**Zone centrale** :
```
Grille 3√ó3

          Ligue 1   Premier League   La Liga
France    [_____]      [_____]       [_____]
Br√©sil    [_____]      [_____]       [_____]
Argentine [_____]      [_____]       [_____]

Cases remplies: 3/9
```

**Fonctionnalit√©s** :
- Autocompl√©tion avec filtres (ligue + pays)
- Validation imm√©diate par case
- Indication visuelle (vert = correct, rouge = incorrect)

**Fin de partie** :
- Timer √† 0 OU 9 cases remplies
- Appel `validate_grid_answer()`
- Navigation vers `GameResultsScreen`

---

#### 4.5.4 CLUB - Interface

**Zone centrale** :
```
[Photo du joueur]

Kylian Mbapp√©

Quel est son club actuel ?

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [Real Madrid__________________]    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

           [Valider]

Joueurs devin√©s: 3/15
```

**Fonctionnalit√©s** :
- Saisie libre (pas d'autocompl√©tion pour augmenter difficult√©)
- Clic "Valider" ‚Üí v√©rification
- Si correct : joueur suivant automatiquement
- Si incorrect : affichage bonne r√©ponse, puis joueur suivant

**D√©tails de validation et scoring** :
- Objectif : deviner le club actuel du joueur.
- Source de v√©rit√© : `players.current_club` (table `players`).
- Indices possibles (configurables) : photo, silhouette, nationalit√©, poste. Pas d‚Äôautocompl√©tion pour garder la difficult√©.
- Scoring : 1 bonne r√©ponse = 10 points. S√©rie de N joueurs (ex. 15) par partie.
- Variantes (futures) : mode chrono (60s), mode survie (1 erreur = fin), mode parcours (difficult√© croissante).

**Fin de partie** :
- Timer √† 0 OU tous les joueurs pr√©sent√©s
- Appel `validate_club_answers()`
- Navigation vers `GameResultsScreen`

---

### 4.6 R√©sultats de Partie

**√âcran** : `GameResultsScreen`

**Props** : `match_id`

**Layout** :

**A. Score Principal**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                ‚îÇ
‚îÇ       üèÜ                        ‚îÇ
‚îÇ                                ‚îÇ
‚îÇ      SCORE FINAL               ‚îÇ
‚îÇ        70/100                  ‚îÇ
‚îÇ                                ‚îÇ
‚îÇ    üçí +70 Cerises               ‚îÇ
‚îÇ                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**B. D√©tails (selon mode)**

**Solo** :
- Score obtenu
- R√©ponses correctes/incorrectes
- Temps √©coul√©
- Clafoutis gagn√©s

**Multijoueur/Ligue** :
- Classement de la partie
  1. Marie - 90 pts ü•á
  2. **Toi - 70 pts** ü•à
  3. Paul - 60 pts ü•â
  4. Julie - 50 pts
- Cerises gagn√©es (selon rang)

**C. Boutons**
- "Rejouer" (nouvelle partie solo imm√©diate)
- "Acheter des jeux" (redirection vers shop)
- "Retour" (page pr√©c√©dente)
- "Partager" (screenshot + share)

---

### 4.7 Achat de Jeux

#### 4.7.1 √âcran d'Achat de Jeux

**√âcran** : `BuyGamesScreen`

**Fonctionnalit√©s** :
- **Liste des jeux disponibles** : TOP10, GRILLE, CLUB
- **Prix en cerises** : Chaque jeu a un co√ªt en cerises
- **Achat imm√©diat** : D√©duction des cerises, d√©blocage du jeu
- **Confirmation** : Modal de confirmation avant achat
- **Solde** : Affichage du solde de cerises disponible

**Interface** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üçí Mes Cerises : 150                ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  üéÆ Jeux Disponibles                 ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  TOP 10                         ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  üçí 50 cerises                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  [Acheter] [D√©j√† achet√© ‚úì]      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  GRILLE 3x3                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  üçí 75 cerises                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  [Acheter] [D√©j√† achet√© ‚úì]      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  CLUB                           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  üçí 100 cerises                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  [Acheter] [D√©j√† achet√© ‚úì]      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  [Retour]                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Flux d'achat** :
1. Clic "Acheter" sur un jeu
2. Modal de confirmation : "D√©penser X cerises pour d√©bloquer ce jeu ?"
3. Confirmation ‚Üí D√©duction des cerises, d√©blocage du jeu
4. Retour √† la liste avec statut "D√©j√† achet√© ‚úì"

#### 4.7.2 Syst√®me de Navigation

**Fonctionnalit√©s** :
- **Bouton Retour** : Pr√©sent sur tous les √©crans (sauf Home)
- **Historique** : Navigation vers la page pr√©c√©dente
- **Breadcrumbs** : Indication du chemin (optionnel)
- **Menu contextuel** : Acc√®s rapide aux fonctions principales

**Impl√©mentation** :
- **React Router** : `useNavigate()` avec `navigate(-1)`
- **√âtat global** : Historique des pages visit√©es
- **Fallback** : Retour vers Home si pas d'historique

---

### 4.8 Ligues

#### 4.8.1 Liste des Ligues

**√âcran** : `LeagueListScreen`

**Tabs** :
- Mes Ligues (ligues o√π je suis membre)
- Invitations (invitations en attente)

**Card Ligue** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üèÜ Ligue des Champions              ‚îÇ
‚îÇ  üë§ Admin: Paul                      ‚îÇ
‚îÇ  üë• 6 membres                         ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  üìä Match 3/10                        ‚îÇ
‚îÇ  ‚è∞ Prochaine partie: Dans 2 jours   ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  üìà Ta position: 2√®me (650 pts)      ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  [Voir D√©tails]                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Bouton** : "+ Cr√©er une Ligue"

---

#### 4.8.2 D√©tails d'une Ligue

**√âcran** : `LeagueDetailScreen`

**Props** : `league_id`

**Tabs** :
1. Parties
2. Classement
3. Membres

**Tab 1: Parties**
```
Partie 3/10 - TOP10
‚è∞ Disponible maintenant
Deadline: 23h45 restantes
[Jouer Maintenant]

Partie 2/10 - GRILLE ‚úì
Termin√©e il y a 2 jours
Ton score: 70/90
[Voir R√©sultats]

Partie 1/10 - CLUB ‚úì
Termin√©e il y a 9 jours
Ton score: 80/150
[Voir R√©sultats]
```

**Tab 2: Classement**
```
ü•á 1. Marie      890 pts
ü•à 2. Toi        650 pts
ü•â 3. Paul       620 pts
   4. Julie      580 pts
   5. Marc       540 pts
   6. Sophie     490 pts
```

**Tab 3: Membres**
- Liste des membres
- Statut (actif/inactif)
- Si admin : bouton "Inviter"

---

#### 4.8.3 Cr√©ation d'une Ligue

**√âcran** : `CreateLeagueScreen`

**Formulaire** :
```
Nom de la ligue *
[______________________________]

Nombre de parties *
[10 ‚ñº] (5, 10, 15, 20)

Fr√©quence des parties *
‚óã Quotidien (1 partie/jour)
‚óè Hebdomadaire (1 partie/semaine)
‚óã Mensuel (1 partie/mois)

Inviter des amis
[Rechercher amis...]

üë§ Paul        [√ó]
üë§ Marie       [√ó]
üë§ Julie       [√ó]

         [Cr√©er la Ligue]
```

**Flux** :
1. Remplissage formulaire
2. S√©lection amis √† inviter
3. Clic "Cr√©er"
4. Cr√©ation entr√©e `leagues`
5. Ajout admin dans `league_members`
6. Envoi invitations aux amis s√©lectionn√©s
7. Redirection vers `LeagueDetailScreen`

**G√©n√©ration Automatique des Parties** :
- Supabase Edge Function ou Cron
- D√©clench√©e selon `match_frequency`
- Cr√©ation `match` avec mode='league'
- Cr√©ation `match_participants` pour tous les membres actifs
- Envoi notifications √† tous

---

### 4.9 Social

#### 4.9.1 Liste d'Amis

**√âcran** : `FriendsScreen`

**Tabs** :
- Amis (friendships.status = 'accepted')
- Demandes re√ßues (friendships.status = 'pending', friend_id = moi)
- Demandes envoy√©es (friendships.status = 'pending', user_id = moi)

**Card Ami** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üë§ Paul                         ‚îÇ
‚îÇ  üèÜ Rang: #234                   ‚îÇ
‚îÇ  üìä Score: 5,420                 ‚îÇ
‚îÇ                                  ‚îÇ
‚îÇ  [Inviter √† Jouer]d, friend_id)
);

-- Indexes
CREATE INDEX idx_friendships_user ON friendships(user_id);
CREATE INDEX idx_friendships_friend ON friendships(friend_id);
CREATE INDEX idx_friendships_status ON friendships(status);
```

**R√®gles m√©tier** :
- User A envoie demande √† User B ‚Üí status 'pending'
- User B accepte ‚Üí status 'accepted'
- Amiti√© unidirectionnelle en BDD, bidirectionnelle en logique app

---

#### 3.3.12 **invitations** (Invitations)

Invitations √† des parties multijoueurs ou ligues.

```sql
CREATE TABLE invitations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  sender_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  receiver_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  match_id UUID REFERENCES matches(id) ON DELETE CASCADE,
  league_id UUID REFERENCES leagues(id) ON DELETE CASCADE,
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'accepted', 'declined', 'expired')),
  sent_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  responded_at TIMESTAMP WITH TIME ZONE,
  CHECK (sender_id != receiver_id),
  CHECK ((match_id IS NOT NULL AND league_id IS NULL) OR (match_id IS NULL AND league_id IS NOT NULL))
);

-- Indexes
CREATE INDEX idx_invitations_receiver ON invitations(receiver_id);
CREATE INDEX idx_invitations_sender ON invitations(sender_id);
CREATE INDEX idx_invitations_status ON invitations(status);
```

**R√®gles m√©tier** :
- Soit `match_id`, soit `league_id` (pas les deux)
- Expiration automatique apr√®s 7 jours si non r√©pondue

---

#### 3.3.13 **notifications** (Notifications In-App)

Notifications affich√©es dans l'application.

```sql
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  type VARCHAR(50) NOT NULL,
  title VARCHAR(255) NOT NULL,
  message TEXT,
  data JSONB,                            -- Donn√©es contextuelles
  is_read BOOLEAN DEFAULT false,
  is_push_sent BOOLEAN DEFAULT false,    -- Tracking push mobile
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  read_at TIMESTAMP WITH TIME ZONE
);

-- Indexes
CREATE INDEX idx_notifications_user_unread ON notifications(user_id, is_read, created_at);
CREATE INDEX idx_notifications_type ON notifications(type);
```

**Types de notifications** :
- `league_match_start` : Nouvelle partie de ligue disponible
- `league_match_ending` : Partie expire dans 1h
- `match_completed` : R√©sultats d'une partie
- `invitation_received` : Invitation √† partie/ligue
- `invitation_accepted` : Invitation accept√©e
- `friendship_request` : Demande d'ami
- `friendship_accepted` : Ami accept√©
- `league_completed` : Ligue termin√©e
- `new_rank` : Nouveau classement atteint

**Exemple de `data` (JSONB)** :
```json
{
  "type": "league_match_start",
  "league_id": "uuid-league",
  "league_name": "Ligue des Champions",
  "match_id": "uuid-match",
  "game_type": "TOP10",
  "deadline": "2024-10-21T12:00:00Z",
  "action_url": "/matches/uuid-match"
}
```

---

#### 3.3.14 **push_tokens** (Tokens Push Notifications)

Tokens FCM/APNs pour notifications push mobiles.

```sql
CREATE TABLE push_tokens (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  token TEXT NOT NULL,
  platform VARCHAR(20) NOT NULL CHECK (platform IN ('ios', 'android', 'web')),
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(user_i